os: linux
sudo: false

cache:
  cargo: true
  directories:
    - $HOME/qemu

language: rust
rust:
  - nightly

before_install:
  - rustup component add rust-src
  - rustup component add llvm-tools-preview

install:
  - test -f $HOME/.cargo/bin/cargo-xbuild || cargo install cargo-xbuild
  - test -f $HOME/.cargo/bin/cargo-bootimage || cargo install bootimage --version "^0.7.3"

before_script:
  - bash -e travis-qemu.bash
  - export PATH=$PATH:$HOME/qemu/bin

script:
  - cargo xbuild
  - cargo bootimage
  - cargo xtest
